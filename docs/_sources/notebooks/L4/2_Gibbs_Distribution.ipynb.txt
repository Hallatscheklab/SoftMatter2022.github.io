{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Particle exchange and chemical potential"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "So far, we have considered closed systems and derived and studied the Boltzmann distribution.  Now our systems are open and the particle number might change. To derive the probability to find a system with an energy $E_\\mathrm{s}$ and a particle number $N_\\mathrm{s}$, we retrace the steps that led us to the Boltzmann distribution, except for allowing the system to trade particles with the bath.  "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Again, the probability to find a system with  energy $E_\\mathrm{s}$ and particle number $N_\\mathrm{s}$ is proportional to the number of bath states,\n",
    "$$P(\\nu_s)\\propto e^{k_\\mathrm{B}^{-1}S_b(E-E_s,N-N_s)}\\;.$$\n",
    "Next we Taylor expand the entropy of the large bath,\n",
    "$$k_\\mathrm{B}^{-1}S_b(E-E_s,N-N_s)=\\mathrm{const.}-\\beta_b(E_s-\\mu_b N_s)\\;,$$\n",
    "where we have the usual thermodynamic definition of temperature\n",
    "$$T_b^{-1}=\\frac{\\partial S_b}{\\partial E}$$\n",
    "and introduced the **chemical potential**\n",
    "$$\\mu_b=-T_b \\frac{\\partial S_b}{\\partial N}\\;.$$\n",
    "With these definitions, we obtain the **Gibbs distribution**\n",
    "$$P(\\nu_s)=Z^{-1}e^{-\\beta_b\\left[E_s-\\mu_b N_s\\right]}$$\n",
    "where the grand canonical partition function $Z$ is given by the sum\n",
    "$$Z=\\sum_i e^{-\\beta_b\\left[E_s^{(i)}-\\mu_b N_s^{(i)}\\right]}$$\n",
    "over all microstates $i$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "To obtain the probability to find the system at energy $E_s$ and $N_s$, we have multiply the Gibbs distribution with the multiplicity of system states,\n",
    "$$P(E_s,N_s)\\propto e^{k_\\mathrm{B}^{-1}S_s(E_s,N_s)}e^{-\\beta_b\\left[E_s-\\mu_b N_s\\right]}\\;.$$\n",
    "If the system is large, this distribution has a pronounced peak, such that the system will have an almost deterministic energy $U$ and particle number $N$. The conditions for the maximum imply \n",
    "$$T_b=T_s\\qquad \\mu_b=\\mu_s\\;.$$\n",
    "Thus, temperatures and chemical potentials of bath and system are equal at equilibrium. \n",
    "\n",
    "Consideration of spontaneous processes shows that the equilibrium minimizes the grand potential\n",
    "$$\\Sigma=-k_\\mathrm{B}T\\ln Z=U-T S- \\mu N$$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Volume exchange and pressure "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In complete analogy, we can also treat the case where bath and system trade energy and volume, which we briefly summarize for completeness. One obtains the microstate distribution\n",
    "$$P(\\nu_s)\\propto e^{-\\beta_b\\left[E_s+p_b dV_s\\right]}$$\n",
    "with the equilibrium condition of equal pressures $p_b=p_s$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Consideration of spontaneous processes shows that the equilibrium minimizes the Gibbs free energy\n",
    "$$G=U-T S+PV=\\sum_i \\mu_i N_i \\;,$$\n",
    "where the last sum goes over all particle species $i$. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-info\">\n",
    "    \n",
    "**Ligand Binding**    \n",
    "\n",
    "As an example, we have a look at the binding of a ligand (green) to a receptor, which is indicated in the figure below.\n",
    "    \n",
    "![Two State Binding](img/two_state_binding.png)\n",
    "\n",
    "The binding is reported by the variable $\\sigma$, which can be either 0 or 1. The binding energy is therefore \n",
    "    \n",
    "\\begin{equation}\n",
    "E=\\sigma \\varepsilon_\\mathrm{b}\n",
    "\\end{equation}\n",
    "\n",
    "with $\\varepsilon_\\mathrm{b}<0$, since the ligand wants to bind. The grand partition function\n",
    "    \n",
    "\\begin{equation}    \n",
    "Z=\\sum_{\\rm states}\\exp\\left ( -\\beta (E_{\\rm state}- \\mu N_{\\rm state}) \\right ),\n",
    "\\end{equation}\n",
    "\n",
    "\n",
    "in which the chemical potential $\\mu$ reflects the contact with the particle reservoir and $\\beta=(k_\\mathrm{B}T)^{-1}$, can therefore be written as:\n",
    "    \n",
    "\\begin{equation}    \n",
    "Z=\\sum_{\\sigma=0}^{1}\\exp\\left ( -\\beta (\\varepsilon_\\mathrm{b} \\sigma- \\mu \\sigma) \\right )=1+\\exp(-\\beta (\\varepsilon_\\mathrm{b} -\\mu )).\n",
    "\\end{equation}\n",
    "\n",
    "From that we can calculate the mean number of bounded ligands to be\n",
    "    \n",
    "\\begin{equation}    \n",
    "\\langle N \\rangle =\\frac{\\exp(-\\beta (\\varepsilon_\\mathrm{b} -\\mu ))}{1+\\exp(-\\beta (\\varepsilon_\\mathrm{b} -\\mu ))}.\n",
    "\\end{equation}  \n",
    "    \n",
    "Using \n",
    "    \n",
    "\\begin{equation}\n",
    "\\mu = \\mu_0 + k_\\mathrm{B} T \\ln \\left ( \\frac{c}{c_0}\\right )\n",
    "\\end{equation}\n",
    "    \n",
    "we can finally write \n",
    "    \n",
    " \\begin{equation}    \n",
    "\\langle N \\rangle =\\frac{c/c_0 \\exp(-\\beta \\Delta \\varepsilon_\\mathrm{b})}{1+\\frac{c}{c_0}\\exp(-\\beta \\Delta \\varepsilon_\\mathrm{b})}\n",
    "\\end{equation}    \n",
    "    \n",
    "with $\\Delta \\varepsilon_\\mathrm{b}=\\varepsilon_\\mathrm{b}-\\mu_0$, which is the energy freed when taking the ligand from the solution and placing it at the acceptor.    \n",
    "</div>    "
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.12"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": false
  },
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {},
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
